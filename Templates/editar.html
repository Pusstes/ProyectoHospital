if session['rol'] == 'MedicoAdmin' %}
    {% extends 'plantillaAdmin.html' %}
{% else %}
    {% extends 'plantilla.html' %}
{% endif %}

{% block body %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h2 class="text-center mb-0">
                        <i class="fas fa-user-edit me-2"></i>Editar Médico
                    </h2>
                </div>
                <div class="card-body p-4">
                    <form id="editarMedicoForm" action="/ActualizarMedico/{{ medico[0] }}" method="POST" class="needs-validation" novalidate>
                        <div class="mb-3">
                            <label for="rfc" class="form-label">
                                <i class="fas fa-id-card me-2"></i>RFC
                            </label>
                            <input type="text" class="form-control" id="rfc" name="rfc" value="{{ medico[1] }}" required>
                            <div class="invalid-feedback">Este campo es obligatorio.</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="nombre" class="form-label">
                                <i class="fas fa-user me-2"></i>Nombre
                            </label>
                            <input type="text" class="form-control" id="nombre" name="nombre" value="{{ medico[2] }}" required>
                            <div class="invalid-feedback">Este campo es obligatorio.</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="cedula" class="form-label">
                                <i class="fas fa-certificate me-2"></i>Cédula
                            </label>
                            <input type="text" class="form-control" id="cedula" name="cedula" value="{{ medico[3] }}" required>
                            <div class="invalid-feedback">Este campo es obligatorio.</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="correo" class="form-label">
                                <i class="fas fa-envelope me-2"></i>Correo
                            </label>
                            <input type="email" class="form-control" id="correo" name="correo" value="{{ medico[4] }}" required>
                            <div class="invalid-feedback">Ingrese un correo electrónico válido.</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="especialidad" class="form-label">
                                <i class="fas fa-stethoscope me-2"></i>Especialidad
                            </label>
                            <input type="text" class="form-control" id="especialidad" name="especialidad" value="{{ medico[5] }}" required>
                            <div class="invalid-feedback">Este campo es obligatorio.</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="pass" class="form-label">
                                <i class="fas fa-lock me-2"></i>Contraseña
                            </label>
                            <input type="password" class="form-control" id="pass" name="pass" value="{{ medico[7] }}" required>
                            <div class="invalid-feedback">Este campo es obligatorio.</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="rol" class="form-label">
                                <i class="fas fa-user-tag me-2"></i>Rol
                            </label>
                            <select class="form-select" id="rol" required name="rol">
                                <option value="">Seleccione un rol</option>
                                <option value="MedicoAdmin" {% if medico[8] == 'MedicoAdmin' %}selected{% endif %}>Médico Admin</option>
                                <option value="Medico" {% if medico[8] == 'Medico' %}selected{% endif %}>Médico</option>
                            </select>
                            <div class="invalid-feedback">Seleccione un rol.</div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a class="btn btn-outline-secondary me-md-2" href="/consulta">
                                <i class="fas fa-arrow-left me-2"></i>Regresar a los registros
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Actualizar Médico
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('editarMedicoForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const rfc = document.getElementById('rfc').value.trim();
    const nombre = document.getElementById('nombre').value.trim();
    const cedula = document.getElementById('cedula').value.trim();
    const correo = document.getElementById('correo').value.trim();
    const especialidad = document.getElementById('especialidad').value.trim();
    const pass = document.getElementById('pass').value.trim();
    const rol = document.getElementById('rol').value.trim();
    
    if (!rfc || !nombre || !cedula || !correo || !especialidad || !pass || !rol) {
        Swal.fire({
            title: 'Error',
            text: 'Por favor, complete todos los campos antes de continuar.',
            icon: 'error',
            confirmButtonText: 'Ok'
        });
        return;
    }

    Swal.fire({
        title: '¿Confirmar cambios?',
        html: `<div class="text-start">
               <p><b><i class="fas fa-id-card me-2"></i>RFC:</b> ${rfc}</p>
               <p><b><i class="fas fa-user me-2"></i>Nombre:</b> ${nombre}</p>
               <p><b><i class="fas fa-certificate me-2"></i>Cédula:</b> ${cedula}</p>
               <p><b><i class="fas fa-envelope me-2"></i>Correo:</b> ${correo}</p>
               <p><b><i class="fas fa-stethoscope me-2"></i>Especialidad:</b> ${especialidad}</p>
               <p><b><i class="fas fa-user-tag me-2"></i>Rol:</b> ${rol}</p>
               </div>`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sí, actualizar',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            e.target.submit();
        }
    });
});

// Validación de formulario
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();
</script>
{% endblock %}

