<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda de Citas - Hospital San Cristo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* Navbar margins */
    nav.navbar {
      margin-bottom: 20px;
    }
  
    /* Footer margins */
    footer {
      margin-top: 20px;
    }
  
    /* Body padding for fixed navbar */
    body {
      padding-top: 70px;
      background-color: #f8f9fa;
    }

    /* Simple card styling */
    .simple-card {
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
      margin-bottom: 20px;
    }
    
    .simple-card:hover {
      transform: translateY(-5px);
    }

    .card-header {
      border-radius: 10px 10px 0 0 !important;
      font-weight: 600;
    }

    /* Appointment item styling */
    .appointment-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
      transition: background-color 0.2s;
    }

    .appointment-item:hover {
      background-color: rgba(0, 123, 255, 0.05);
    }

    .appointment-item:last-child {
      border-bottom: none;
    }

    /* Simple form styling */
    .simple-form {
      padding: 20px;
    }

    .simple-form .btn-primary {
      background-color: #007bff;
      border-color: #007bff;
      padding: 10px 20px;
      font-weight: 500;
    }

    .simple-form .btn-primary:hover {
      background-color: #0069d9;
      border-color: #0062cc;
    }

    /* Date coloring */
    .text-today {
      color: #28a745;
      font-weight: 600;
    }

    .text-future {
      color: #007bff;
    }

    .text-past {
      color: #6c757d;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="/Home">Hospital San Cristo</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar" aria-labelledby="offcanvasDarkNavbarLabel">
        <li class="nav-item">
          <span class="navbar-text">Médico: {{ session['nombre_medico'] }}</span>
        </li>    
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasDarkNavbarLabel">Acciones</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/Home">Página principal</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Gestion de Médicos
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                <!-- link de la template de consulta -->
                <li><a class="dropdown-item" href="/consulta">Médicos registrados</a></li>
                <li><a class="dropdown-item" href="/registro">Registrar Médico</a></li>
                <li><a class="dropdown-item" href="/todas_consultas">Consultas Medicos</a></li>
                <li><a class="dropdown-item" href="/todos_pacientes">Pacientes</a></li>
              </ul>
            </li>
            <!-- gestion de pacientes -->
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Gestión de Pacientes
            </a>
            <ul class="dropdown-menu dropdown-menu-dark">
              <li><a class="dropdown-item" href="/expedientes">Generar Expediente</a></li>
              <li><a class="dropdown-item" href="/consultaP">Consulta de Expedientes </a></li>
              <li><a class="dropdown-item" href="/consulta_exploracion_diagnostigo">Dar Consulta</a></li>
              <li><a class="dropdown-item" href="/citas_medico">Registro de las consultas</a></li>
            </ul>
          </li>
          <!-- gestion de dashboards -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Gestion de Dashboards
            </a>
            <ul class="dropdown-menu dropdown-menu-dark">
              <!-- link de la template de consulta -->
              <li><a class="dropdown-item" href="/medicinas">Panel de Medicina</a></li>
              <li><a class="dropdown-item" href="/estudios">Panel de estudios</a></li>
            </ul>
          </li>
          <!-- citas -->
           <li>
            <a class="nav-link active" aria-current="page" href="/programarCitas">Registro de Citas</a>
           </li>
          <li class="nav-item">
          <li class="nav-item">
          <button type="button" class="btn btn-outline-danger" onclick="confirmLogout()">Cerrar sesión</button>
        </li>
          <!-- fin gestion pacientes -->
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container">
    <div class="row mb-4">
      <div class="col">
        <h1 class="h3 fw-bold"><i class="fas fa-calendar-plus text-primary me-2"></i>Agenda de Citas</h1>
        <p class="text-muted">Sistema simple de agendamiento de citas para Hospital San Cristo</p>
      </div>
    </div>

    <div class="row">
      <!-- Form to schedule appointments -->
      <div class="col-md-5">
        <div class="card simple-card">
          <div class="card-header bg-primary text-white">
            <i class="fas fa-calendar-plus me-2"></i> Nueva Cita
          </div>
          <div class="card-body simple-form">
            <form id="appointmentForm">
              <div class="mb-3">
                <label for="patientName" class="form-label">Nombre del Paciente</label>
                <input type="text" class="form-control" id="patientName" required>
              </div>
              <div class="mb-3">
                <label for="appointmentDate" class="form-label">Fecha</label>
                <input type="date" class="form-control" id="appointmentDate" required>
              </div>
              <div class="mb-3">
                <label for="appointmentTime" class="form-label">Hora</label>
                <input type="time" class="form-control" id="appointmentTime" required>
              </div>
              <div class="mb-3">
                <label for="medicalArea" class="form-label">Área Médica</label>
                <select class="form-select" id="medicalArea" required>
                  <option value="" selected disabled>Seleccionar área</option>
                  <option value="Medicina General">Medicina General</option>
                  <option value="Cardiología">Cardiología</option>
                  <option value="Pediatría">Pediatría</option>
                  <option value="Ginecología">Ginecología</option>
                  <option value="Traumatología">Traumatología</option>
                  <option value="Odontología">Odontología</option>
                  <option value="Dermatología">Dermatología</option>
                  <option value="Neurología">Neurología</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-save me-2"></i> Guardar Cita
              </button>
            </form>
          </div>
        </div>
      </div>
      
      <!-- List of appointments -->
      <div class="col-md-7">
        <div class="card simple-card">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <div>
              <i class="fas fa-calendar me-2"></i> Citas Agendadas
            </div>
            <div class="d-flex">
              <input type="text" class="form-control form-control-sm me-2" id="searchPatient" placeholder="Buscar paciente...">
              <button id="clearSearch" class="btn btn-sm btn-light">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <div class="card-body p-0">
            <div id="appointmentList" class="appointment-list">
              <!-- Appointments will be shown here -->
              <div class="text-center py-5 text-muted">
                <i class="fas fa-calendar-day fa-3x mb-3"></i>
                <p>No hay citas agendadas.</p>
                <p>Ingresa un nombre en el formulario para agendar.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="text-white text-center text-lg-start bg-dark">
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
      © 2025 Copyright: Hospital San Cristo
    </div>
  </footer>

  <!-- JavaScript for the appointments functionality -->
  <script>
    // Store appointments in localStorage
    let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
    
    // DOM Elements
    const appointmentForm = document.getElementById('appointmentForm');
    const appointmentList = document.getElementById('appointmentList');
    const searchPatient = document.getElementById('searchPatient');
    const clearSearch = document.getElementById('clearSearch');
    
    // Format date helper function
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('es-MX', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric'
      });
    }
    
    // Determine date class for styling
    function getDateClass(dateStr) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const appointmentDate = new Date(dateStr);
      appointmentDate.setHours(0, 0, 0, 0);
      
      if (appointmentDate.getTime() === today.getTime()) {
        return 'text-today';
      } else if (appointmentDate > today) {
        return 'text-future';
      } else {
        return 'text-past';
      }
    }
    
    // Display appointments
    function displayAppointments(appointmentsToShow = appointments) {
      if (appointmentsToShow.length === 0) {
        appointmentList.innerHTML = `
          <div class="text-center py-5 text-muted">
            <i class="fas fa-calendar-day fa-3x mb-3"></i>
            <p>No hay citas agendadas.</p>
            <p>Ingresa un nombre en el formulario para agendar.</p>
          </div>
        `;
        return;
      }
      
      // Sort appointments by date and time
      appointmentsToShow.sort((a, b) => {
        // Create date objects for comparison
        const dateA = new Date(a.date + 'T' + a.time);
        const dateB = new Date(b.date + 'T' + b.time);
        return dateA - dateB;
      });
      
      appointmentList.innerHTML = '';
      appointmentsToShow.forEach((appointment, index) => {
        const dateClass = getDateClass(appointment.date);
        
        const appointmentEl = document.createElement('div');
        appointmentEl.className = 'appointment-item';
        appointmentEl.innerHTML = `
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-1">${appointment.patientName}</h5>
              <p class="mb-1 ${dateClass}">
                <i class="far fa-calendar-alt me-2"></i>${formatDate(appointment.date)} - ${appointment.time}
              </p>
              <span class="badge bg-info">${appointment.medicalArea}</span>
            </div>
            <div>
              <button class="btn btn-sm btn-outline-danger delete-btn" data-index="${index}">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        `;
        appointmentList.appendChild(appointmentEl);
      });
      
      // Add event listeners to delete buttons
      document.querySelectorAll('.delete-btn').forEach(button => {
        button.addEventListener('click', function() {
          const index = this.getAttribute('data-index');
          deleteAppointment(index);
        });
      });
    }
    
    // Add new appointment
    function addAppointment(appointment) {
      appointments.push(appointment);
      localStorage.setItem('appointments', JSON.stringify(appointments));
      displayAppointments();
      
      // Show success message
      Swal.fire({
        title: '¡Cita Agendada!',
        text: `La cita para ${appointment.patientName} ha sido agendada exitosamente.`,
        icon: 'success',
        timer: 2000,
        showConfirmButton: false
      });
    }
    
    // Delete appointment
    function deleteAppointment(index) {
      Swal.fire({
        title: '¿Eliminar esta cita?',
        text: "Esta acción no se puede revertir",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Sí, eliminar',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          const deletedAppointment = appointments[index];
          appointments.splice(index, 1);
          localStorage.setItem('appointments', JSON.stringify(appointments));
          displayAppointments();
          
          Swal.fire(
            '¡Eliminada!',
            `La cita de ${deletedAppointment.patientName} ha sido eliminada.`,
            'success'
          );
        }
      });
    }
    
    // Filter appointments by patient name
    function filterAppointments(searchTerm) {
      if (!searchTerm) {
        displayAppointments();
        return;
      }
      
      const filtered = appointments.filter(appointment => 
        appointment.patientName.toLowerCase().includes(searchTerm.toLowerCase())
      );
      
      displayAppointments(filtered);
    }
    
    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Display existing appointments
      displayAppointments();
      
      // Form submission
      appointmentForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const patientName = document.getElementById('patientName').value;
        const date = document.getElementById('appointmentDate').value;
        const time = document.getElementById('appointmentTime').value;
        const medicalArea = document.getElementById('medicalArea').value;
        
        if (!patientName || !date || !time || !medicalArea) {
          Swal.fire({
            title: 'Error',
            text: 'Por favor complete todos los campos',
            icon: 'error'
          });
          return;
        }
        
        const appointment = {
          patientName,
          date,
          time,
          medicalArea
        };
        
        addAppointment(appointment);
        appointmentForm.reset();
      });
      
      // Search functionality
      searchPatient.addEventListener('input', function() {
        filterAppointments(this.value);
      });
      
      // Clear search
      clearSearch.addEventListener('click', function() {
        searchPatient.value = '';
        displayAppointments();
      });
    });
    
    // Logout confirmation
    function confirmLogout() {
      Swal.fire({
        title: '¿Estás seguro que quieres cerrar la sesión?',
        text: "¡Regresaras a la página principal!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Sí, cerrar sesión',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire(
            '¡Sesión cerrada!',
            'Has salido exitosamente.',
            'success'
          );
        }
      });
    }
  </script>
</body>
</html>